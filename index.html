<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>사과 먹기</title>
    <!--웹사이트 아이콘-->
    <link rel="apple-touch-icon" sizes="57x57" href="/2D-game/favicon-EatingApple/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/2D-game/favicon-EatingApple/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/2D-game/favicon-EatingApple/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href "/2D-game/favicon-EatingApple/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/2D-game/favicon-EatingApple/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/2D-game/favicon-EatingApple/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/2D-game/favicon-EatingApple/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/2D-game/favicon-EatingApple/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/2d-game/favicon-EatingApple/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/2D-game/favicon-EatingApple/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/2D-game/favicon-EatingApple/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/2D-game/favicon-EatingApple/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/2D-game/favicon-EatingApple/favicon-16x16.png">
    <link rel="manifest" href="/2D-game/favicon-EatingApple/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/2D-game/favicon-EatingApple/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">

    <style>
        body {
            text-align: center;
        }
        #game-canvas {
            border: 2px solid black;
        }
    </style>
</head>
<body>
    <p id="level">레벨: 1</p> <!-- 초기 레벨을 1로 설정 -->

    <canvas id="game-canvas" width="700" height="500"></canvas>

    <script>
        // 캔버스 엘리먼트 가져오기
        const canvas = document.getElementById("game-canvas");
        const ctx = canvas.getContext("2d");

        // 객체 초기 위치
        let enemy_x = canvas.width / 2;
        let enemy_y = canvas.height / 2;

        // 플레이어 이미지 객체
        const playerImage = new Image();
        playerImage.src = "rabbit.png"; // 플레이어 이미지 파일 경로

        // 플레이어 이미지 초기 위치
        let playerX = canvas.width / 2;
        let playerY = canvas.height / 6;

        // 플레이어 이미지 그리기 함수
        const playerWidth = 60;
        const playerHeight = 100;

        function drawPlayer() {
            ctx.drawImage(playerImage, playerX-playerWidth/2, playerY-playerHeight/2, playerWidth, playerHeight); // 원하는 크기로 조정
        }

        // 이미지 로딩 여부 확인을 위한 변수
        let imagesLoaded = 0;
        const totalImages = 3;

        // 이미지 객체
        const image1 = new Image();
        const image2 = new Image();
        const image3 = new Image();

        // 이미지 로딩 함수
        function loadImage(src, image) {
            image.src = src;
            image.onload = function() {
                imagesLoaded++;
                if (imagesLoaded === totalImages) {
                    AttackBall();
                }
            };
        }

        // 이미지 파일 로딩
        loadImage("stump.png", image1);
        loadImage("stump.png", image2);
        loadImage("apple.png", image3);

        // 공 속도 및 방향
        let dx = 2;
        let dy = 2;

        // 공 반지름
        const ballRadius = 20;

        // 초기 레벨 및 속도 설정
        let level = 1;
        document.getElementById("level").textContent = "레벨: " + level; // 레벨 업데이트

        let ballSpeed = 2;

        // 초기 사과 위치 확인
        let CollisionNum = 0;

        // AttackBall 함수
        function AttackBall() {
            // 캔버스 지우기
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // 캔버스 색채우기
            ctx.fillStyle = "rgb(191,219,137)";
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // 각 이미지 크기
            const stump_x = 96;
            const stump_y = 48;

            const apple_x = 56.5;
            const apple_y = 60;

            // 그루터기 이미지 추가
            ctx.drawImage(image1, canvas.width/2 - stump_x/2, 80-stump_y/2, stump_x, stump_y);
            ctx.drawImage(image2, canvas.width/2 - stump_x/2, canvas.height-80-stump_y/2, stump_x, stump_y);   
            
            // 사과 이미지 추가
            ctx.drawImage(image3, canvas.width/2 - apple_x/2, canvas.height-120-apple_y, apple_x, apple_y);
            
            // 적 공 그리기 (색상와 반지름 변경)
            drawBall(enemy_x, enemy_y, "red", ballRadius);

            // 공 이동
            enemy_x += dx;

            // 화면 경계 충돌 검사
            if (enemy_x + dx > canvas.width - ballRadius || enemy_x + dx < ballRadius) {
                dx = -dx;
            }

            // 플레이어 공 그리기
            drawPlayer();

            // 충돌 감지
            if (checkCollision(playerX, playerY, playerWidth, playerHeight, enemy_x, enemy_y, ballRadius)) {
                // 충돌 시 초기화
                level = 1;
                ballSpeed = 2;
                playerX = canvas.width / 2;
                playerY = canvas.height / 6;
                enemy_x = canvas.width / 2;
                enemy_y = canvas.height / 2;

                CollisionNum = 0;
                apple_y = canvas.height-120-apple_y

                // 레벨 표시 업데이트
                document.getElementById("level").innerHTML = "레벨: " + level;
            }

            // 사과 충돌 감지
            if (checkCollision(playerX, playerY, playerWidth, playerHeight, canvas.width/2 - apple_x/2, canvas.height-120-apple_y, apple_x) && CollisionNum==0) {
                // 충돌 시 레벨 증가 및 속도 증가
                level++;
                ballSpeed += 1;

                // 충돌 시 사과 위치 결정 변수 증가
                CollisionNum++;

                // 다음 위치로 이동
                apple_y = 120-apple_y;

                // 레벨 업데이트
                document.getElementById("level").textContent = "레벨: " + level;
            }
            else if (checkCollision(playerX, playerY, playerWidth, playerHeight, canvas.width/2 - apple_x/2, 120-apple_y, apple_x) && CollisionNum==1) {
                level++;
                ballSpeed += 1;

                // 충돌 시 사과 위치 결정 변수 감소
                CollisionNum -= 1;

                apple_y = canvas.height-120-apple_y;

                document.getElementById("level").textContent = "레벨: " + level;
            }

            requestAnimationFrame(AttackBall);
        }

        // 공 그리기 함수
        function drawBall(x, y, color, radius) {
            ctx.beginPath();
            ctx.arc(x, y, radius, 0, Math.PI * 2);
            ctx.fillStyle = color;
            ctx.fill();
            ctx.closePath();
        }

        // 충돌 감지 함수
        function checkCollision(playerX, playerY, playerWidth, playerHeight, enemyX, enemyY, enemyRadius) {
            const distX = Math.abs(playerX - enemyX - enemyRadius);
            const distY = Math.abs(playerY - enemyY - enemyRadius);

            if (distX > (playerWidth / 2 + enemyRadius)) return false;
            if (distY > (playerHeight / 2 + enemyRadius)) return false;

            if (distX <= playerWidth / 2) return true;
            if (distY <= playerHeight / 2) return true;

            const dx = distX - playerWidth / 2;
            const dy = distY - playerHeight / 2;
            return (dx * dx + dy * dy <= (enemyRadius * enemyRadius));
        }
        
        // 방향키 입력 감지
        const keys = {};  // 키 입력 상태 저장

        document.addEventListener("keydown", function(event) {
            keys[event.key] = true;
        });

        document.addEventListener("keyup", function(event) {
            keys[event.key] = false;
        });

        function movePlayer() {
            playerSpeed = 6

            if (keys["ArrowLeft"] && playerX - playerSpeed > playerWidth/2) {
                playerX -= playerSpeed;
            }
            if (keys["ArrowRight"] && playerX + playerSpeed < canvas.width - playerWidth/2) {
                playerX += playerSpeed;
            }
            if (keys["ArrowUp"] && playerY - playerSpeed > playerHeight/2) {
                playerY -= playerSpeed;
            }
            if (keys["ArrowDown"] && playerY + playerSpeed < canvas.height - playerHeight/2) {
                playerY += playerSpeed;
            }
        }

        setInterval(movePlayer, 10);  // 10ms마다 플레이어 이동 함수 호출
    </script>

    <p>
        게임 소개: 가운데 공을 피해 사과 먹기<br>
        게임 방법: 방향키
    </p>

</body>
</html>
